
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fibre Estimation &#8212; Diffusion MRI</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tractography" href="tractography.html" />
    <link rel="prev" title="Preprocessing" href="preprocessing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      <h1 class="site-logo" id="site-title">Diffusion MRI</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../main.html">
   UCL Summer School: Diffusion MRI
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Diffusion
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../diffusion/introduction.html">
   Introduction to Diffusion MRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../diffusion/diffusion_test.html">
   Check your Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../diffusion/coding_assignment.html">
   Coding Assignment
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tractography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tractography/introduction.html">
   Introduction to Tractography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tractography/tractography_test.html">
   Check your Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tractography/coding_assignment.html">
   Coding Assignment
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Advanced Tractography
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="workshop.html">
   DTI Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="preprocessing.html">
   MRtrix3 DWI Preprocessing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   MRtrix3 DWI Fibre Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tractography.html">
   MRtrix3 Tractography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/pages/advanced_tractography/postprocessing.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io//issues/new?title=Issue%20on%20page%20%2Fpages/advanced_tractography/postprocessing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/edit/master/pages/advanced_tractography/postprocessing.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-identification">
   Data identification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#singleshell-csd">
   SingleShell CSD
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multishell-csd">
   MultiShell CSD
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#single-shell-3-tissue-csd-ss3t">
   Single-Shell 3-Tissue CSD (SS3T)
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="fibre-estimation">
<h1>Fibre Estimation<a class="headerlink" href="#fibre-estimation" title="Permalink to this headline">¶</a></h1>
<p><em>by Lawrence Binding</em></p>
<div class="tip admonition">
<p class="admonition-title">Estimated Time</p>
<p>10 minutes</p>
</div>
<p>Here we will be estimating our fibre orientation. This may sound familiar as the outcome will be the same as the first days coding task. Don’t worry, other people have coding these advanced methods!</p>
<style>
h1 {text-align: center;}
h2 {text-align: center;}
</style>
<hr class="docutils" />
<div class="section" id="data-identification">
<h2>Data identification<a class="headerlink" href="#data-identification" title="Permalink to this headline">¶</a></h2>
<p>Before we decide which postprocessing method to use, we need to identify if our data was acquired with multiple b-values. Different types of tissue are sensitive to different strengths of diffusion gradient (b-values). We can tell this by looking at our b-value file and seeing if there is more than 2 unique values (e.g., 0, 1000, 2000, etc.).</p>
</div>
<hr class="docutils" />
<div class="section" id="singleshell-csd">
<h2>SingleShell CSD<a class="headerlink" href="#singleshell-csd" title="Permalink to this headline">¶</a></h2>
<p>The advanced method we’re going to use is constrained spherical deconvolution (CSD). This method elimiates all priors but one: All white matter shares identical diffusion characteristics. As such, diffusion is mapped over a sphere of response function with the fibre orinetation density function (ODF). First we need to estimate our responses function with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir tournier
dwi2response tournier fibrecup_denoise_gibbs_preproc_biaCorr.mif tournier/wm.txt
</pre></div>
</div>
<p>Then we can map each response to a voxel with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dwi2fod csd fibrecup_denoise_gibbs_preproc_biaCorr.mif tournier/wm.txt tournier/wm.mif 
</pre></div>
</div>
<p>We can inspect our ODFs with the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mrview fibrecup_denoise_gibbs_preproc_biaCorr.mif -odf.load_sh tournier/wm.mif 
</pre></div>
</div>
<figure>
<img src="../../_static/img/odf.png" alt="colab" style="width:461px;height:383px;">
<figcaption>Fig.1 - Showing fibre orientation direction after estimation.</figcaption>
</figure>
---
</div>
<div class="section" id="multishell-csd">
<h2>MultiShell CSD<a class="headerlink" href="#multishell-csd" title="Permalink to this headline">¶</a></h2>
<p>Where Multishell differs from single Shell CSD is its ability to only estimate white matter. CSD rests upon the assumption that all white matter is the same, not the entire brain is the same! Multishell CSD takes advantage of the fact different tissues have different diffusion principals so we can estimate WM, GM, and CSF seperately! This comes with the benefit of improved estimation! We can do this by:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir dhollander
dwi2response dhollander fibrecup_denoise_gibbs_preproc_biaCorr.mif dhollander/wm.txt dhollander/gm.txt dhollander/csf.txt
</pre></div>
</div>
<p>Then we can map each response to a voxel with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dwi2fod msmt fibrecup_denoise_gibbs_preproc_biaCorr.mif dhollander/wm.txt dhollander/wm.mif dhollander/gm.txt dhollander/gm.mif dhollander/csf.txt dhollander/csf.mif
</pre></div>
</div>
<p>We can inspect our ODFs with the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mrview fibrecup_denoise_gibbs_preproc_biaCorr.mif -odf.load_sh dhollander/wm.mif 
</pre></div>
</div>
</div>
<div class="section" id="single-shell-3-tissue-csd-ss3t">
<h2>Single-Shell 3-Tissue CSD (SS3T)<a class="headerlink" href="#single-shell-3-tissue-csd-ss3t" title="Permalink to this headline">¶</a></h2>
<p>We’re not going to cover this method today as it requires a seperate installation of MRtrix3 known as MRtrix3Tissue. This method estimates the 3-Tissues from singleshelled diffusion data. In our experience, this has better performance than just singleshell CSD. You can find more information about this method here: https://3tissue.github.io.</p>
<style>
  .iframe-container {
		text-align:center;
  		width:100%;
  }
</style>
<div class="admonition-further-reading admonition">
<p class="admonition-title">Further reading</p>
<ul class="simple">
<li><p>blah blah</p></li>
<li><p>blah blah</p></li>
<li><p>blah blah</p></li>
<li><p>blah blah</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./pages/advanced_tractography"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="preprocessing.html" title="previous page">Preprocessing</a>
    <a class='right-next' id="next-link" href="tractography.html" title="next page">Tractography</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By UCL–CMIC Summer School<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>